<!DOCTYPE html>
<html>
  <head>
    <title>NSP Task 4 E-FAD</title>
<script src="./jspsych/jspsych.js"></script>
    <script src="./jspsych/plugin-image-keyboard-response.js"></script>
    <script src="./jspsych/plugin-html-keyboard-response.js"></script>
    <script src="./jspsych/plugin-preload.js"></script>
    <link href="./jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="./jspsych/my_experiment_style_MRI.css">
    <script src="./jspsych/plugin-categorize-html.js"></script>
  </head>
  <body></body>
  <script>
/* TASK INFO: explicit FAD task 4 blocks, 1 per condition, with no practice trials; alternative order to explicitFAD.html */

    /* initialize jsPsych */
    var jsPsych = initJsPsych({
        on_finish: function() {
            // running local
            // display the data
			jsPsych.data.get().localSave('json', 'EFAD_data_task4.json');
          }
        }
    );

    /* create timeline */
    var timeline = [];

    // Pre load images first, Define image sets
var iaps_neut = ['iaps_neut/6150.jpg', 'iaps_neut/7001.jpg', 'iaps_neut/7002.jpg', 'iaps_neut/7009.jpg', 'iaps_neut/7026.jpg', 'iaps_neut/7052.jpg', 'iaps_neut/7055.jpg', 'iaps_neut/7080.jpg', 'iaps_neut/7100.jpg', 'iaps_neut/7150.jpg', 'iaps_neut/7705.jpg'];
var iaps_neg = ['iaps_neg/1525.jpg', 'iaps_neg/2345_1.jpg', 'iaps_neg/3150.jpg', 'iaps_neg/3170.jpg', 'iaps_neg/7380.jpg', 'iaps_neg/9140.jpg', 'iaps_neg/9184.jpg', 'iaps_neg/9301.jpg', 'iaps_neg/9326.jpg', 'iaps_neg/9611.jpg', 'iaps_neg/9903.jpg'];
var iaps_pos = ['iaps_pos/1463.jpg', 'iaps_pos/1811.jpg', 'iaps_pos/2071.jpg', 'iaps_pos/2154.jpg', 'iaps_pos/4610.jpg', 'iaps_pos/5480.jpg', 'iaps_pos/5829.jpg', 'iaps_pos/7400.jpg', 'iaps_pos/7492.jpg', 'iaps_pos/8380.jpg', 'iaps_pos/8503.jpg'];
var sdvp_stim = ['sdvp/3068.jpg', 'sdvp/6570.jpg', 'sdvp/SDVPS_1.jpg', 'sdvp/SDVPS_2.jpg', 'sdvp/SDVPS_3.jpg', 'sdvp/SDVPS_4.jpg', 'sdvp/SDVPS_5.jpg', 'sdvp/SDVPS_6.jpg', 'sdvp/SDVPS_7.jpg', 'sdvp/SDVPS_8.jpg'];

// Combine all images into one array for preloading
var all_images = [].concat(iaps_neut, iaps_neg, iaps_pos, sdvp_stim, ['img/response_key.png']); 

var preload = {
    type: jsPsychPreload,
    images: all_images,
    message: `
        <div style="text-align:center;">
            <p><strong>Preparing Task...</strong></p>
            <div style="width:300px; height: 20px; background-color: #ddd; margin: auto;">
                <div id="jspsych-preload-progress-bar" style="background-color: #333; height: 20px; width: 0%;"></div>
            </div>
            <p>Please wait until all stimuli are cached.</p>
        </div>`,
    auto_preload: false, // We are manually providing the list for "forced" loading
    continue_after_error: false, // CRITICAL: Stop the task if a file is missing
    error_message: '<p>Error: One or more images failed to load. Please check your file paths and server connection.</p>',
    on_finish: function(data) {
        console.log("Forced Preload Complete. Status:", data.success ? "Success" : "Failed");
    }
};

timeline.push(preload);

			var welcome = { type: jsPsychHtmlKeyboardResponse, stimulus: " <p>Welcome to the Emotion Rating Task! </p> <p>Press any button for instructions. </p>",
				    choices: "ALL_KEYS",
      response_ends_trial: true
    };
			timeline.push(welcome);

			var instructions = { type: jsPsychHtmlKeyboardResponse, stimulus: "<p>In this task, an image will appear on the screen.</p><p>Using the response pad, please rate <strong>HOW a picture makes you feel</strong>, as quickly as you can.</p>", 
		choices: "ALL_KEYS",
      response_ends_trial: true,
      post_trial_gap: 1000 
	};
	timeline.push(instructions);
			var instructions2 = { type: jsPsychHtmlKeyboardResponse, stimulus: "<p>If the picture makes you feel...</p> <p><strong>Very negative</strong>, press the button 1</p><p><strong>Negative</strong>, press the button 2</p><p><strong>Positive</strong>, press the button 3</p> <p><strong>Very positive</strong>, press the button 4.</p><p> <img src='" + "img/response_key.png' alt='Key'></div></p>", 			choices: "ALL_KEYS",
      response_ends_trial: true,
      post_trial_gap: 1000 };
			timeline.push(instructions2);

			/*questions for the examiner*/
var questions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<p>If you have questions or concerns, please signal to the examiner. </p> <p>If not, press any button to continue. </p>"
    };
    timeline.push(questions);

/*define trial awaiting for the scanner keyboard button #5 */
var MRIstart ={
  type: jsPsychHtmlKeyboardResponse,
  stimulus: "<p> Please wait while the scanner starts up. This will take 10 seconds. </strong></p>",
  choices: ['5'],
 prompt: "<p> A cross (+) will appear when the task starts. </p>",
 data: {
    task: 'mri_start'},
    on_finish: function(data){
    data.response;
 }
};
timeline.push(MRIstart);
var fixation_start = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  response_ends_trial: false,
  trial_duration: 15000,
  data: {
    task: 'fixation_start'
  }
};	
timeline.push(fixation_start);
			var test_stimuli = [
				{stimulus: 'iaps_neg/1525.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/2345_1.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/3150.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/3170.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/7380.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9140.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9184.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9301.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9326.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9611.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9903.jpg', condition:'negative'}, 

                {stimulus: 'iaps_pos/1463.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/1811.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/2071.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/2154.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/4610.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/5480.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/5829.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7400.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7492.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/8380.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/8503.jpg', condition:'positive'},

                {stimulus: 'sdvp/3068.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/6570.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_1.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_2.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_3.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_4.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_5.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_6.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_7.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_8.jpg', condition:'suicide'}, 
                
                {stimulus: 'iaps_neut/6150.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7001.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7002.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7009.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7026.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7052.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7055.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7080.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7100.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7150.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7705.jpg', condition:'neutral'}, 

                {stimulus: 'iaps_neg/1525.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/2345_1.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/3150.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/3170.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/7380.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9140.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9184.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9301.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9326.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9611.jpg', condition:'negative'}, 
                {stimulus: 'iaps_neg/9903.jpg', condition:'negative'}, 

                {stimulus: 'iaps_neut/6150.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7001.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7002.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7009.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7026.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7052.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7055.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7080.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7100.jpg', condition:'neutral'}, 
                {stimulus: 'iaps_neut/7150.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7705.jpg', condition:'neutral'}, 

                {stimulus: 'sdvp/3068.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/6570.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_1.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_2.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_3.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_4.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_5.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_6.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_7.jpg', condition:'suicide'}, 
                {stimulus: 'sdvp/SDVPS_8.jpg', condition:'suicide'},

               {stimulus: 'iaps_pos/1463.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/1811.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/2071.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/2154.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/4610.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/5480.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/5829.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7400.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7492.jpg', condition:'positive'}, 
                {stimulus: 'iaps_pos/8380.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/8503.jpg', condition:'positive'},
			];

    var fixation = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  trial_duration: 600,
  response_ends_trial: false,
  data: {
    task: 'fixation'
  }
};				
var test = { type: jsPsychImageKeyboardResponse, stimulus: jsPsych.timelineVariable('stimulus'), 
	choices: "NO_KEYS", 
	trial_duration: 750, 
	stimulus_height: 650,
	maintain_aspect_ratio: true,
  response_ends_trial: false,
};

var response = { 
	type: jsPsychHtmlKeyboardResponse, stimulus: "<p>How would you rate this image?</p>", 
	 choices: ['1', '2', '3', '4'], 
     trial_duration: 1400, 
	 response_ends_trial: false,
  data: {
        task: 'response',
        prime: jsPsych.timelineVariable('stimulus'), // Records the prime image
        condition: jsPsych.timelineVariable('condition'), //Records condition
  },
  on_finish: function(data){
    data.response;
  }
};

var test_procedure = { 
timeline: [fixation, test, response], 
timeline_variables: test_stimuli, 
repetitions: 1, 
randomize_order: false, 
post_trial_gap: 250, 
};
timeline.push(test_procedure);


var fixation_end = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  response_ends_trial: false,
  trial_duration: 15000,
  data: {
    task: 'fixation_end'
  }
};	
timeline.push(fixation_end);
    
var debrief_block = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {

    var trials = jsPsych.data.get().filter({task: 'response'});
    var rt = Math.round(trials.select('rt').mean());

    return `<p>Your average response time was ${rt}ms.</p>
      <p>Press any key to complete the experiment. Thank you for your time!</p>`;
      }
};
timeline.push(debrief_block);


    /* start the experiment */
    jsPsych.run(timeline);

    /*get data */
  

  </script>
</html>
